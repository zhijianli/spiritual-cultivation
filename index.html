<!DOCTYPE html>
<html>
<head>
    <title>釜托寺文案生成器</title>
    <link rel="stylesheet" type="text/css" href="./static/css/styles.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>

    <script type="text/javascript">

        window.onload = function() {
            var select1 = document.getElementById('select1');
            var select2 = document.getElementById('select2');
            var options2 = {
                "文化内容": ["具体项目", "法讯", "釜托公告", "釜托历史"],
                "活动内容": ["具体项目", "五路财神", "观音送子", "孝恩塔"],
                "寺院内容": ["具体项目", "釜托禅", "行.禅", "禅.修", "共修"]
            }
            var radioButtons = document.getElementsByName('option');


            select1.onchange = function() {
                var selectedOption = select1.options[select1.selectedIndex].value;

                while (select2.options.length) {
                    select2.remove(0);
                }

                var options = options2[selectedOption];
                if (options) {
                    var len = options.length;
                    for (var i=0; i<len; i++) {
                        var option = document.createElement('option');
                        option.text = options[i];
                        option.value = options[i];
                        select2.add(option);
                    }
                }
            };

            select2.onchange = function() {
                var selectedOption = select2.options[select2.selectedIndex].value;
                inputPromptBox.value = "写一篇关于釜托寺 " + selectedOption + " 的内容。";
            };
            for (var i=0; i<radioButtons.length; i++) {
                radioButtons[i].onchange = function() {
                    if (this.checked) {
                        var selectedOption = select2.options[select2.selectedIndex].value;
                        var selectedRadio = this.value;
                        inputPromptBox.value = "写一篇关于釜托寺 " + selectedOption + " 的 " + selectedRadio + " 内容";
                    }
                };
            }

            var generateCopyBtn = document.getElementById('generateCopyBtn');
            var inputMaxCharactersBox = document.getElementById('inputMaxCharactersBox');
<!--            var inputContentBox = document.getElementById('inputContentBox');-->
            var overlay = document.getElementById('overlay');
            var radios = document.getElementsByName('option');




            generateCopyBtn.onclick = function() {

                quill.clipboard.dangerouslyPasteHTML('');
                var inputValue = inputPromptBox.value;
                var maxCharacters = inputMaxCharactersBox.value;

                // Show the overlay
                overlay.style.display = 'flex';

                var socket = new WebSocket('ws://127.0.0.1:8000/ws');

                socket.onopen = function(e) {
                    socket.send(
                        JSON.stringify({
                          cmd: "generate",
                          maxCharacters: maxCharacters,
                          inputValue: inputValue,
                        })
                    );
                };

                socket.onmessage = function(event) {
                    console.log('Received message:', event.data);
                    let dataObject = JSON.parse(event.data);
                    if (dataObject.state == "continue") {
                      console.log("continue");
                      // 这里你可以添加处理接收到的数据的代码
<!--                      inputContentBox.value = inputContentBox.value + dataObject.data;-->
                      quill.clipboard.dangerouslyPasteHTML(quill.getText()+dataObject.data);
                      // Hide the overlay when the request completes
                      overlay.style.display = 'none';
                      socket.send(
                        JSON.stringify({
                          cmd: "ack",
                        })
                      );
                    }
                };

                socket.onerror = function(error) {
                    console.log(`[error] ${error.message}`);
                };
            };
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="row" >
           <img src="/static/images/ftslogo.jpg" alt="Description of image" width="50" height="50" style="display: inline-block;">
           <p style="font-size:35px;display: inline-block;">釜托寺文案生成器</p>

        </div>
        <br>
        <br>
        <div class="row" >
            <select id="select1" class = "dropdown">
                <option>内容选择</option>
                <option>文化内容</option>
                <option>活动内容</option>
                <option>寺院内容</option>
            </select>
            <select id="select2" class = "dropdown">

            </select>
        </div>

        <div class="radio-group">
           <label>
                <input type="radio" name="option" value="微博"> 微博
            </label>
            <label>
                <input type="radio" name="option" value="微信公众号"> 微信公众号
            </label>
            <label>
                <input type="radio" name="option" value="微信朋友圈"> 微信朋友圈
            </label>
            <label>
                <input type="radio" name="option" value="小红书"> 小红书
            </label>
        </div>
        <div class="row">
            <input type="text" id="inputPromptBox", placeholder="提示词，比如：写一篇关于釜托寺的介绍文章">
            <input type="text" id= "inputMaxCharactersBox" placeholder="最大字数，比如:100">
        </div>
<!--        <div class="row">-->

<!--        </div>-->
        <div class="row">
            <button id="generateCopyBtn" >开始生成文案</button>
        </div>
        <br>
<!--        <div class="row">-->
<!--            <textarea id= "inputContentBox" class="input-area" placeholder="文案内容"></textarea>-->
<!--        </div>-->
        <div class="row">
          <div id="inputContentBox">
            <p></p>
          </div>
       </div>
                <br>
        <br>
        <br>
        <div class="row">
            <input id="timeSelectionBox" type="datetime-local">
        </div>


        <div class="row">
            <button id="releaseBtn">发布</button>
        </div>
         <!-- Overlay for the entire page -->
        <div id="overlay">
            <div class="spinner"></div>
        </div>
    </div>

  <!-- Include the Quill library -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <!-- Include the Quill Image Upload module -->
  <script src="https://cdn.jsdelivr.net/npm/quill-image-upload"></script>


  <!-- Initialize Quill editor -->
  <script>
    var toolbarOptions = [
      ['bold', 'italic', 'underline', 'strike'],      // 样式
      ['link', 'image'],                              // 链接和图片
      ['clean'],                                      // 清除格式
      [{ 'size': ['small', false, 'large', 'huge'] }], // 字体大小
      [{ 'color': [] }, { 'background': [] }]
    ];
    var quill = new Quill('#inputContentBox', {
      theme: 'snow',
      modules: {
        toolbar: toolbarOptions,
<!--        imageUpload: {-->
<!--          url: '/upload',                              // 上传图片的后端接口URL-->
<!--          method: 'POST',                              // 图片上传请求的方法-->
<!--          name: 'image',                               // 图片上传字段的名称-->
<!--          withCredentials: false,                      // 是否发送跨域请求的凭据-->
<!--          headers: {-->
<!--            'X-CSRF-Token': 'your-csrf-token'           // 如果需要，可以设置自定义的请求头-->
<!--          },-->
<!--          callbackOK: (imageUrl, imageAlt) => {         // 图片上传成功的回调函数-->
<!--            var range = quill.getSelection();-->
<!--            quill.insertEmbed(range.index, 'image', imageUrl, Quill.sources.USER);-->
<!--            quill.setSelection(range.index + 1, Quill.sources.SILENT);-->
<!--          },-->
<!--          callbackKO: (error, response) => {             // 图片上传失败的回调函数-->
<!--            console.error(error);-->
<!--          }-->
<!--        }-->
      }
    });
  </script>
</body>
</html>
